## Geiger unsafe-scan 摘要

下面是 `cargo geiger` 对 `crates/ark-wallet-cli` 运行后的聚合结果（按 unsafe 表达式数降序）。此表已聚合相同 crate+version 的计数，供团队审阅。

（表格节选，完整 CSV 保存在 `./tmp_logs/geiger_top30_aggregated.csv`）

| crate | version | unsafe_expr_used | unsafe_expr_total | functions_used | functions_total | impls_used | impls_total |
|---|---:|---:|---:|---:|---:|---:|---:|
| generic-array | 0.14.7 | 1995 | 1995 | 7 | 7 | 140 | 140 |
| memchr | 2.7.5 | 1973 | 2421 | 27 | 41 | 2 | 2 |
| sha2 | 0.10.9 | 1424 | 5656 | 64 | 144 | 0 | 0 |
| aes | 0.8.4 | 765 | 1113 | 18 | 43 | 0 | 0 |
| windows-sys | 0.60.2 | 708 | 35700 | 0 | 0 | 0 | 0 |
| ppv-lite86 | 0.2.21 | 632 | 680 | 2 | 2 | 0 | 0 |
| ryu | 1.0.20 | 572 | 702 | 7 | 9 | 0 | 0 |
| anyhow | 1.0.99 | 464 | 470 | 16 | 19 | 3 | 3 |
| bitcoin_hashes | 0.13.0 | 409 | 409 | 1 | 1 | 0 | 0 |
| zerocopy | 0.8.27 | 403 | 403 | 5 | 5 | 40 | 40 |

---

## 针对 top-3 依赖的简要审计建议

1) sha2 (v0.10.9)
- 用途：SHA-2 系列哈希算法实现，用于消息摘要和签名/验证流程的底层哈希。
- 潜在风险：加密库若实现有漏洞会导致错误输出、碰撞或验证失败；unsafe 主要用于性能优化。\
- 建议措施：锁定到当前版本并检查上游变更日志与 CVE；在关键路径添加单元测试（已知向量）；如需更高保证，可考虑使用社区更广泛审计过的实现或替代库。

2) bitcoin_hashes (v0.13.0)
- 用途：比特币相关哈希工具集合（用于地址、公钥哈希等）。\
- 潜在风险：哈希实现/边界处理中的 bug 影响钱包地址/验签。\
- 建议措施：锁定版本、审查上游发布记录；对钱包使用的具体哈希函数做已知测试向量覆盖；如果可能，优先选择被广泛采用与审计的实现。

3) zerocopy (v0.8.27)
- 用途：为高性能二进制序列化/反序列化提供零拷贝类型转换（以字节视图直接解释内存）。\
- 潜在风险：unsafe/transmute 使用不当会导致未定义行为、内存布局/对齐/对端序问题，若不谨慎使用会带来严重安全缺陷。\
- 建议措施：检查项目中所有使用 zerocopy 的位置，封装为安全接口；增加边界与序列化回归测试；对零拷贝边界使用 Miri 运行相关测试以检测 UB；必要时替换为更安全的序列化方案或手动验证边界处理。

---

完整的聚合 CSV 与原始 geiger 输出位于仓库 `./tmp_logs/`：
- `geiger_top30_aggregated.csv`（聚合 CSV）
- `geiger_ark_wallet_cli.txt`（完整 geiger 运行日志）

建议的下一步（可在本 PR 中作为任务列表）：
- [ ] 将 `cargo geiger` 与 `cargo audit` 加入 CI 的快速检查（PR 触发）。
- [ ] 为上述 top-3 依赖建立版本锁定与监控（Cargo.lock 固定 + 依赖审查）。
- [ ] 在关键 crypto/zero-copy 单元路径上运行 Miri 并增加测试覆盖。

请审阅并留言是否要我把这个模板转换为草稿 PR（包含以上文件/表格与任务项）。
